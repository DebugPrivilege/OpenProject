# Microsoft Protection Logs

MpLogs are diagnostic logs generated by Microsoft Defender Antivirus that record detailed information about Defender’s security actions, such as malware detections, scans, and command-line operations flagged as suspicious. Stored in `C:\ProgramData\Microsoft\Windows Defender\Support`, these logs contain data like file paths, timestamps, threat names, and process metrics. During DFIR, MpLogs are valuable for tracing malware activity and identifying the files or processes that triggered alerts, such as malicious PowerShell commands or attempts to disable Defender for example. 

I created this script for Live Response scenarios with Defender for Endpoint. When an alert is triggered on an endpoint, it helps me quickly gather diagnostic logs generated by Windows Defender Antivirus to give me a broader insight to check if there were additional detections or suspicious activity.

## How to parse MpLogs

1. If you run this script without any arguments, it will look for the MpLog file on the local machine in `C:\ProgramData\Microsoft\Windows Defender\Support` and display all parsed results in the console.

```
.\MpLogParser.ps1
```

![image](https://github.com/user-attachments/assets/bcd28891-cffd-4da0-97fa-9467ce4b137f)

2. If you use the `-CsvOutput` parameter, you can specify a folder to save all identified results from the MpLogs as a CSV file.

```
.\MpLogParser.ps1 -CsvOutput C:\MpResults\Results.csv
```

![image](https://github.com/user-attachments/assets/acb113a9-82b9-4270-8591-ab4c129a7040)


3. If you receive a disk image or VHD(X) from a customer and need to parse the MpLog file, you can use the `-FilePath` parameter to specify the exact location of the MpLog file.

```
.\MpLogParser.ps1 -FilePath C:\Users\Admin\Desktop\MPLog-20240704-220133.log
```

![image](https://github.com/user-attachments/assets/1d471d0f-d1bc-4ce7-92a9-2548db62f0c5)

4. You can combine the `-CsvOutput` parameter with `-FilePath` as well to save the results in CSV format.

```
.\MpLogParser.ps1 -FilePath .\MPLog-20240704-220133.log -CsvOutput C:\MpResults\Results.csv
```

5. Now, you can use Eric Zimmerman’s Timeline Explorer to load the .CSV output and analyze the raw data.

![image](https://github.com/user-attachments/assets/4a13a700-efd2-4d93-aa0b-d6166706ebb3)



