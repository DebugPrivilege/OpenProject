# YARA

YARA is a tool that helps identify and classify malware by using rules to find specific patterns in files, like strings or code fragments. It's useful in malware analysis because you can create custom rules to detect known malware or find related files that share similar traits.

You can use **LOKI** to quickly run a set of YARA rules across multiple binaries to check for signs of malware or suspicious behavior. **LOKI** is a scanner that comes with a collection of pre-built YARA rules and can also run custom rules you provide. This makes it a powerful tool for performing quick triage and detecting potential threats in binaries by matching them against known malware patterns.

## How to start?

1. First, gather all the malware samples you’ve received and place them in a single folder. For this example, we’ll store the samples in the C:\Temp folder, which we have also excluded from Windows Defender AV.

![image](https://github.com/user-attachments/assets/3cf62ded-9cd6-438a-a1c2-b02fd8909972)

2. Run the following LOKI command:

```
loki.exe -p C:\Temp --noprocscan
```
LOKI flagged some malware samples in the **C:\Temp** folder as suspicious and issued a warning, recommending further analysis of these samples.

![image](https://github.com/user-attachments/assets/8445758a-e37b-4741-b258-6984ad8365fd)

When Loki triggers an alert highlighted in red, it’s typically a strong indication that the file is malicious, rather than just suspicious.

![image](https://github.com/user-attachments/assets/38470e88-0a49-4f7d-98d1-0b5921216706)

## How to exend YARA rules?

Loki has a subfolder within the **signature-base** directory that holds all the YARA rules.

![image](https://github.com/user-attachments/assets/24d917a2-529a-4d7b-a03e-6bbcabbc9ba5)

In this example, there are a few malware samples in the C:\Temp folder, but none of the current YARA rules are detecting anything malicious.

![image](https://github.com/user-attachments/assets/d5ed3d11-eb94-4454-9a21-76535e8504ef)

1. For example, the team at Elastic Security has created a collection of YARA rules that we can download and place into the "yara" subfolder within the signature-base directory. See: https://github.com/elastic/protections-artifacts/

![image](https://github.com/user-attachments/assets/3a02dc25-6f61-4cc4-88e9-d960dd21bc61)

2. In this example, we've downloaded the YARA rules from the Elastic Security repository and copied all the .yar files into LOKI's "yara" folder.

![image](https://github.com/user-attachments/assets/476320bf-9532-4413-8d37-9e431ced51e5)

3. Scanning the C:\Temp folder now shows some results

![image](https://github.com/user-attachments/assets/ebe90dfa-935a-4a87-b819-e1892e316f85)








